<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Power Mart - Premium Shopping</title>
<style>
body {margin:0;font-family:Arial,sans-serif;background: linear-gradient(135deg,#d4bfff,#b3dfff,#c2f0f0);min-height:100vh;color:#333;}
header {background: rgba(255,255,255,0.9);color:#333;padding:15px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:10;border-bottom:2px solid #a0d4ff;}
header h1{margin:0;font-size:24px;color:#333;}
nav a,#loginBtn{color:#333;margin:0 10px;text-decoration:none;font-weight:bold;transition:0.3s;cursor:pointer;padding:10px 15px;border-radius:8px;border:none;}
nav a:hover,#loginBtn:hover{color:#fff;background:#4287f5;}
.slider{display:flex;overflow-x:auto;scroll-snap-type:x mandatory;background: rgba(255,255,255,0.3);padding:10px;border-radius:15px;margin:15px;}
.slider img{width:100%;max-width:400px;height:200px;object-fit:cover;margin:5px;border-radius:15px;scroll-snap-align:start;transition: transform .3s;border:3px solid #fff;}
.slider img:hover{transform:scale(1.05);border-color:#6ca0ff;}
.search-bar{padding:10px;text-align:center;}
.search-bar input{width:80%;padding:12px;border-radius:10px;border:2px solid #fff;font-size:16px;outline:none;transition:0.3s;}
.search-bar input:focus{border-color:#6ca0ff;background:rgba(255,255,255,0.8);}
.products{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:15px;padding:15px;}
.product{background:#fff;border-radius:15px;box-shadow:0 8px 20px rgba(0,0,0,0.2);padding:10px;text-align:center;transition: transform .3s, box-shadow .3s;display:flex;flex-direction:column;justify-content:space-between;position:relative;min-height:320px;}
.product:hover{transform:translateY(-5px);box-shadow:0 12px 25px rgba(0,0,0,0.3);}
.product img{width:100%;height:150px;object-fit:cover;border-radius:12px;}
.product h3{color:#333;margin:10px 0 5px 0;}
.product p{font-weight:bold;color:#111;}
.product-buttons{display:flex;flex-direction:column;gap:8px;position:absolute;bottom:10px;width:90%;left:50%;transform:translateX(-50%);}
.product-buttons button{width:100%;}
button{background: linear-gradient(45deg,#a0d4ff,#c2f0f0);color:#333;border:none;padding:10px 15px;margin-top:8px;border-radius:12px;cursor:pointer;font-weight:bold;transition:0.3s;}
button:hover{background: linear-gradient(45deg,#b3dfff,#d4bfff);color:#333;}
#cartPage{display:none;padding:20px;}
#cartPage button:first-of-type{margin-bottom:10px;} 
.cart-item{display:flex;align-items:center;justify-content:space-between;background:#fff;margin:10px 0;padding:10px;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,0.2);}
.cart-item img{width:60px;height:60px;object-fit:cover;border-radius:8px;margin-right:10px;}
input,select{width:100%;padding:10px;margin:8px 0;border-radius:10px;border:2px solid #ccc;font-size:16px;outline:none;transition:0.3s;}
input:focus,select:focus{border-color:#6ca0ff;}
.hidden{display:none;}
#transactionLabel{font-weight:bold;margin-top:10px;display:block;color:#6ca0ff;}
.modal{display:none;position:fixed;z-index:100;left:0;top:0;width:100%;height:100%;overflow:auto;background: rgba(0,0,0,0.5);}
.modal-content{background:#fff;margin:10% auto;padding:20px;border-radius:15px;width:90%;max-width:400px;box-shadow:0 10px 25px rgba(0,0,0,0.3);animation:fadeIn 0.5s;}
.order-product{display:flex;justify-content:space-between;align-items:center;margin:8px 0;}
.order-product div{display:flex;align-items:center;gap:5px;}
@keyframes fadeIn{from {opacity:0; transform:translateY(-50px);} to {opacity:1; transform:translateY(0);}}
</style>
</head>
<body>

<header>
  <h1>Power Mart</h1>
  <nav>
    <a onclick="showHome()">Home</a>
    <a onclick="showCart()">Cart ðŸ›’ (<span id='cartCount'>0</span>)</a>
    <button id="loginBtn" onclick="googleLogin()">Login</button>
    <a href="admin.html" target="_blank">Admin Panel</a>
  </nav>
</header>

<div id="loginDiv">
  <p>Please login with Google to view products</p>
</div>

<div class="slider">
  <img src="https://via.placeholder.com/400x200?text=New+Collection+1">
  <img src="https://via.placeholder.com/400x200?text=New+Collection+2">
  <img src="https://via.placeholder.com/400x200?text=New+Collection+3">
</div>

<div class="search-bar">
  <input type="text" id="searchInput" placeholder="Search Products..." onkeyup="searchProducts()">
</div>

<div class="products" id="productList"></div>

<div id="cartPage">
  <h2>Your Cart</h2>
  <button onclick="checkout()">Order Selected Products</button>
  <div id="cartItems"></div>
  <button onclick="showHome()">Back</button>
</div>

<div id="orderModal" class="modal">
  <div class="modal-content">
    <h2>Order Details</h2>
    <div id="orderSummary"></div>
    <p><strong>Total: <span id="totalPrice">0</span> Tk</strong></p>
    <form onsubmit="submitOrder(event)">
      <input type="text" id="name" placeholder="Your Name" required>
      <input type="text" id="address" placeholder="Your Address" required>
      <input type="text" id="mobile" placeholder="Mobile Number" required>
      <select id="payment" onchange="togglePaymentField()" required>
        <option value="">Select Payment Method</option>
        <option value="cod">Cash on Delivery</option>
        <option value="bkash">Bkash</option>
        <option value="nagad">Nagad</option>
      </select>
      <label id="transactionLabel" class="hidden">Payment à¦•à¦°à§‡ Transaction ID à¦¦à¦¿à¦¨:</label>
      <input type="text" id="paymentNumber" class="hidden" placeholder="Enter Transaction ID">
      <button type="submit">Confirm Order</button>
      <button type="button" onclick="closeModal()">Cancel</button>
    </form>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyB--N-R4ION_7YcxD9Uk60hFqsxZzNWcNE",
  authDomain: "power-mart-15795.firebaseapp.com",
  databaseURL: "https://power-mart-15795-default-rtdb.firebaseio.com",
  projectId: "power-mart-15795",
  storageBucket: "power-mart-15795.firebasestorage.app",
  messagingSenderId: "381062091337",
  appId: "1:381062091337:web:3c5c10093198fc20b4e598"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let products=[], cart=[];

// Google Login
function googleLogin(){
  const provider=new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider).then(res=>{
    document.getElementById('loginDiv').style.display='none';
    document.getElementById('loginBtn').style.display='none';
    loadProducts();
  }).catch(err=>alert(err.message));
}

// Load Products from Firebase
function loadProducts(){
  db.collection("products").get().then(snapshot=>{
    products=[];
    snapshot.forEach(doc=>products.push({...doc.data(), id:doc.id}));
    renderProducts();
  });
}

// Render Products
function renderProducts(filtered=null){
  const list=document.getElementById('productList');
  list.innerHTML="";
  const display = filtered||products;
  display.forEach(p=>{
    list.innerHTML+=`
    <div class="product">
      <img src="${p.img}" alt="${p.name}">
      <h3>${p.name}</h3>
      <p>${p.oldPrice ? `<del>${p.oldPrice} Tk</del> ${p.price} Tk` : `${p.price} Tk`}</p>
      <div class="product-buttons">
        <button onclick="addToCart('${p.id}')">Add to Cart</button>
      </div>
    </div>`;
  });
}

// Add to Cart
function addToCart(id){
  const prod = products.find(p=>p.id===id);
  const exist = cart.find(c=>c.id===id);
  if(exist){
    exist.qty++;
  }else{
    cart.push({...prod, qty:1});
  }
  updateCartCount();
  alert(prod.name + " added to cart!");
}

// Update cart count in header
function updateCartCount(){
  const count = cart.reduce((sum,c)=>sum+c.qty,0);
  document.getElementById('cartCount').innerText=count;
}

// Show cart page
function showCart(){
  document.getElementById('productList').style.display='none';
  document.getElementById('cartPage').style.display='block';
  renderCartItems();
}

// Show home page
function showHome(){
  document.getElementById('productList').style.display='grid';
  document.getElementById('cartPage').style.display='none';
}

// Render cart items
function renderCartItems(){
  const container = document.getElementById('cartItems');
  container.innerHTML="";
  cart.forEach(item=>{
    container.innerHTML+=`
    <div class="cart-item">
      <img src="${item.img}" alt="${item.name}">
      <div>
        <strong>${item.name}</strong>
        <p>${item.price} Tk x ${item.qty}</p>
      </div>
      <div>
        <button onclick="changeQty('${item.id}',-1)">-</button>
        <button onclick="changeQty('${item.id}',1)">+</button>
        <button onclick="removeItem('${item.id}')">Remove</button>
      </div>
    </div>`;
  });
}

// Change quantity
function changeQty(id,delta){
  const item = cart.find(c=>c.id===id);
  if(item){
    item.qty+=delta;
    if(item.qty<=0) removeItem(id);
  }
  renderCartItems();
  updateCartCount();
}

// Remove item
function removeItem(id){
  cart = cart.filter(c=>c.id!==id);
  renderCartItems();
  updateCartCount();
}

// Checkout â†’ open modal
function checkout(){
  if(cart.length===0){ alert("Cart is empty!"); return; }
  const summary = document.getElementById('orderSummary');
  let html="";
  let total=0;
  cart.forEach(item=>{
    html+=`<p>${item.name} x ${item.qty} = ${item.price*item.qty} Tk</p>`;
    total += item.price*item.qty;
  });
  summary.innerHTML = html;
  document.getElementById('totalPrice').innerText = total;
  document.getElementById('orderModal').style.display='block';
}

// Close modal
function closeModal(){
  document.getElementById('orderModal').style.display='none';
}

// Toggle payment field
function togglePaymentField(){
  const method = document.getElementById('payment').value;
  const label = document.getElementById('transactionLabel');
  const input = document.getElementById('paymentNumber');
  if(method==='bkash' || method==='nagad'){
    label.classList.remove('hidden');
    input.classList.remove('hidden');
  }else{
    label.classList.add('hidden');
    input.classList.add('hidden');
  }
}

// Submit order
function submitOrder(e){
  e.preventDefault();
  const name = document.getElementById('name').value;
  const address = document.getElementById('address').value;
  const mobile = document.getElementById('mobile').value;
  const payment = document.getElementById('payment').value;
  const transaction = document.getElementById('paymentNumber').value || "";
  const orderData = {
    name,address,mobile,payment,transaction,
    items: cart,
    total: cart.reduce((sum,c)=>sum+c.price*c.qty,0),
    createdAt: new Date()
  };
  db.collection("orders").add(orderData).then(()=>{
    alert("Order placed successfully!");
    cart=[];
    updateCartCount();
    closeModal();
    showHome();
  }).catch(err=>alert(err.message));
}

// Search products
function searchProducts(){
  const query = document.getElementById('searchInput').value.toLowerCase();
  const filtered = products.filter(p=>p.name.toLowerCase().includes(query));
  renderProducts(filtered);
}
</script>
</body>
</html>
