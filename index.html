<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Power Mart - Premium Shopping</title>
<style>
body {margin:0;font-family:Arial, sans-serif;background: linear-gradient(135deg, #d4bfff, #b3dfff, #c2f0f0);}
header {background: rgba(255,255,255,0.9);color: #333;padding: 15px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:10;border-bottom: 2px solid #a0d4ff;}
header h1 {margin:0;font-size:24px;color:#333;}
nav a, nav button {color:#333;margin:0 10px;text-decoration:none;font-weight:bold;border:none;background:none;cursor:pointer;}
nav a:hover, nav button:hover {color:#6ca0ff;}
.slider {display:flex;overflow-x:auto;scroll-snap-type:x mandatory;background: rgba(255,255,255,0.3);padding:10px;border-radius:15px;margin:15px;}
.slider img {width:100%;max-width:400px;height:200px;object-fit:cover;margin:5px;border-radius:15px;scroll-snap-align:start;transition: transform .3s;border:3px solid #fff;}
.slider img:hover {transform:scale(1.05);border-color:#6ca0ff;}
.search-bar {padding:10px;text-align:center;}
.search-bar input {width:80%;padding:12px;border-radius:10px;border:2px solid #fff;font-size:16px;outline:none;transition:0.3s;}
.search-bar input:focus {border-color:#6ca0ff;background:rgba(255,255,255,0.8);}
.products {display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:15px;padding:15px;}
.product {background:#fff;border-radius:15px;box-shadow:0 8px 20px rgba(0,0,0,0.2);padding:10px;text-align:center;transition: transform .3s, box-shadow .3s;display:flex;flex-direction:column;justify-content:space-between;position:relative;min-height:320px;}
.product:hover {transform:translateY(-5px);box-shadow:0 12px 25px rgba(0,0,0,0.3);}
.product img {width:100%;height:150px;object-fit:cover;border-radius:12px;}
.product h3 {color:#333;margin:10px 0 5px 0;}
.product p {font-weight:bold;color:#111;}
.product-buttons {display:flex;flex-direction:column;gap:8px;position:absolute;bottom:10px;width:90%;left:50%;transform:translateX(-50%);}
.product-buttons button {width:100%;}
button {background: linear-gradient(45deg,#a0d4ff,#c2f0f0);color:#333;border:none;padding:10px 15px;margin-top:8px;border-radius:12px;cursor:pointer;font-weight:bold;transition:0.3s;}
button:hover {background: linear-gradient(45deg,#b3dfff,#d4bfff);color:#333;}
#cartPage {display:none;padding:20px;}
#cartPage button:first-of-type {margin-bottom:10px;} 
.cart-item {display:flex;align-items:center;justify-content:space-between;background:#fff;margin:10px 0;padding:10px;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,0.2);}
.cart-item img {width:60px;height:60px;object-fit:cover;border-radius:8px;margin-right:10px;}
input, select {width:100%;padding:10px;margin:8px 0;border-radius:10px;border:2px solid #ccc;font-size:16px;outline:none;transition:0.3s;}
input:focus, select:focus {border-color:#6ca0ff;}
.hidden {display:none;}
#transactionLabel {font-weight:bold;margin-top:10px;display:block;color:#6ca0ff;}
.modal {display:none;position:fixed;z-index:100;left:0;top:0;width:100%;height:100%;overflow:auto;background: rgba(0,0,0,0.5);}
.modal-content {background:#fff;margin:10% auto;padding:20px;border-radius:15px;width:90%;max-width:400px;box-shadow:0 10px 25px rgba(0,0,0,0.3);animation:fadeIn 0.5s;}
.order-product {display:flex;justify-content:space-between;align-items:center;margin:8px 0;}
.order-product div {display:flex;align-items:center;gap:5px;}
#loginDiv {text-align:center;padding:50px;}
#loginDiv button{font-size:18px;padding:12px 20px;}
@keyframes fadeIn {from {opacity:0; transform:translateY(-50px);} to {opacity:1; transform:translateY(0);}}
</style>
</head>
<body>

<header>
  <h1>Power Mart</h1>
  <nav>
    <a href="#" id="profileBtn" class="hidden"></a>
    <a href="#" onclick="showHome()" class="hidden">Home</a>
    <a href="#" onclick="showCart()" class="hidden">Cart ðŸ›’ (<span id='cartCount'>0</span>)</a>
    <button id="logoutBtn" class="hidden">Logout</button>
  </nav>
</header>

<div id="loginDiv">
  <h2>Login to continue</h2>
  <button onclick="googleLogin()">Login with Google</button>
</div>

<div class="slider hidden">
  <img src="https://via.placeholder.com/400x200?text=New+Collection+1" alt="New1">
  <img src="https://via.placeholder.com/400x200?text=New+Collection+2" alt="New2">
  <img src="https://via.placeholder.com/400x200?text=New+Collection+3" alt="New3">
</div>

<div class="search-bar hidden">
  <input type="text" id="searchInput" placeholder="Search Products..." onkeyup="searchProducts()">
</div>

<div class="products" id="productList"></div>

<div id="cartPage">
  <h2>Your Cart</h2>
  <button onclick="checkout()">Order Selected Products</button>
  <div id="cartItems"></div>
  <button onclick="showHome()">Back</button>
</div>

<div id="orderModal" class="modal">
  <div class="modal-content">
    <h2>Order Details</h2>
    <div id="orderSummary"></div>
    <p><strong>Total: <span id="totalPrice">0</span> Tk</strong></p>
    <form onsubmit="submitOrder(event)">
      <input type="text" id="name" placeholder="Your Name" required>
      <input type="text" id="address" placeholder="Your Address" required>
      <input type="text" id="mobile" placeholder="Mobile Number" required>
      <select id="payment" onchange="togglePaymentField()" required>
        <option value="">Select Payment Method</option>
        <option value="cod">Cash on Delivery</option>
        <option value="bkash">Bkash</option>
        <option value="nagad">Nagad</option>
      </select>
      <label id="transactionLabel" class="hidden">Payment à¦•à¦°à§‡ Transaction ID à¦¦à¦¿à¦¨:</label>
      <input type="text" id="paymentNumber" class="hidden" placeholder="Enter Transaction ID">
      <button type="submit">Confirm Order</button>
      <button type="button" onclick="closeModal()">Cancel</button>
    </form>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// Firebase Config (demo credentials, change with your own)
const firebaseConfig = {
  apiKey: "AIzaSyB--N-R4ION_7YcxD9Uk60hFqsxZzNWcNE",
  authDomain: "power-mart-15795.firebaseapp.com",
  databaseURL: "https://power-mart-15795-default-rtdb.firebaseio.com",
  projectId: "power-mart-15795",
  storageBucket: "power-mart-15795.firebasestorage.app",
  messagingSenderId: "381062091337",
  appId: "1:381062091337:web:3c5c10093198fc20b4e598"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Authentication
auth.onAuthStateChanged(user=>{
  if(user){
    document.getElementById('loginDiv').classList.add('hidden');
    document.querySelector('.slider').classList.remove('hidden');
    document.querySelector('.search-bar').classList.remove('hidden');
    document.querySelectorAll('nav a, nav button').forEach(el=>el.classList.remove('hidden'));
    document.getElementById('profileBtn').innerText=user.displayName;
    document.getElementById('profileBtn').href="#";
  }else{
    document.getElementById('loginDiv').classList.remove('hidden');
    document.querySelector('.slider').classList.add('hidden');
    document.querySelector('.search-bar').classList.add('hidden');
    document.querySelectorAll('nav a, nav button').forEach(el=>el.classList.add('hidden'));
  }
});

function googleLogin(){
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider).then(result=>{
    console.log("Logged in as:", result.user.displayName);
  }).catch(err=>alert(err.message));
}

document.getElementById('logoutBtn').addEventListener('click', ()=>{
  auth.signOut();
});

// Products & Cart logic
const products = [
  {id:1, name:"Smartphone", price:15000, img:"https://via.placeholder.com/200?text=Smartphone"},
  {id:2, name:"Headphones", price:2000, img:"https://via.placeholder.com/200?text=Headphones"},
  {id:3, name:"Shoes", price:3000, img:"https://via.placeholder.com/200?text=Shoes"},
  {id:4, name:"Watch", price:5000, img:"https://via.placeholder.com/200?text=Watch"},
];
let cart = [];

function renderProducts(filtered = null){
  const list=document.getElementById('productList');
  list.innerHTML="";
  const displayProducts = filtered || products;
  displayProducts.forEach(p=>{
    list.innerHTML+=`
      <div class="product">
        <img src="${p.img}" alt="${p.name}">
        <h3>${p.name}</h3>
        <p>${p.price} Tk</p>
        <div class="product-buttons">
          <button onclick="addToCart(${p.id})">Add to Cart</button>
          <button onclick="openModal([products.find(pr=>pr.id===${p.id})])">Order Now</button>
        </div>
      </div>
    `;
  });
}

function searchProducts(){
  const query = document.getElementById('searchInput').value.toLowerCase();
  const filtered = products.filter(p => p.name.toLowerCase().includes(query));
  renderProducts(filtered);
}

function addToCart(id){
  const prod=products.find(p=>p.id===id);
  cart.push(prod);
  document.getElementById("cartCount").innerText=cart.length;
  alert(prod.name+" added to cart");
}

function showHome(){
  document.getElementById('productList').style.display="grid";
  document.querySelector('.slider').style.display="flex";
  document.querySelector('.search-bar').style.display="block";
  document.getElementById('cartPage').style.display="none";
}

function showCart(){
  document.getElementById('productList').style.display="none";
  document.querySelector('.slider').style.display="none";
  document.querySelector('.search-bar').style.display="none";
document.getElementById('cartPage').style.display="block";

const items=document.getElementById("cartItems");
items.innerHTML="";
cart.forEach((c,i)=>{
  items.innerHTML+=`
    <div class="cart-item">
      <input type="checkbox" id="select_${i}" checked>
      <img src="${c.img}" alt="${c.name}">
      <span>${c.name} - ${c.price} Tk</span>
      <div>
        <button onclick="removeFromCart(${i})">Remove</button>
      </div>
    </div>
  `;
});
}

function removeFromCart(i){
  cart.splice(i,1);
  document.getElementById("cartCount").innerText=cart.length;
  showCart();
}

function checkout(){
  const selected = [];
  cart.forEach((c,i)=>{
    if(document.getElementById(`select_${i}`).checked) selected.push(c);
  });
  if(selected.length===0){alert("Select at least one product!"); return;}
  openModal(selected);
}

let currentOrder=[];
function openModal(selected=null){
  currentOrder = selected || cart;
  document.getElementById('orderModal').style.display='block';
  const summary = currentOrder.map(p=>`
    <div class="order-product">
      <span>${p.name} - ${p.price} Tk</span>
      <div>
        <button type="button" onclick="changeQty(${p.id}, -1)">-</button>
        <input type="number" min="1" value="1" class="order-qty" data-id="${p.id}" onchange="updateTotal()" style="width:40px;text-align:center;">
        <button type="button" onclick="changeQty(${p.id}, 1)">+</button>
      </div>
    </div>
  `).join('');
  document.getElementById('orderSummary').innerHTML = summary;
  updateTotal();
}

function changeQty(id, delta){
  const inp = document.querySelector(`.order-qty[data-id='${id}']`);
  let val = parseInt(inp.value) + delta;
  if(val<1) val=1;
  inp.value=val;
  updateTotal();
}

function updateTotal(){
  const qtyInputs = document.querySelectorAll(".order-qty");
  let total = 0;
  qtyInputs.forEach(inp=>{
    const prod = products.find(p=>p.id==inp.dataset.id);
    total += prod.price * parseInt(inp.value);
  });
  document.getElementById("totalPrice").innerText = total;
}

function closeModal(){
  document.getElementById('orderModal').style.display='none';
}

function togglePaymentField(){
  const method=document.getElementById("payment").value;
  if(method=="bkash" || method=="nagad"){
    document.getElementById("transactionLabel").classList.remove("hidden");
    document.getElementById("paymentNumber").classList.remove("hidden");
  } else {
    document.getElementById("transactionLabel").classList.add("hidden");
    document.getElementById("paymentNumber").classList.add("hidden");
  }
}

function submitOrder(e){
  e.preventDefault();
  const name=document.getElementById("name").value;
  const address=document.getElementById("address").value;
  const mobile=document.getElementById("mobile").value;
  const payment=document.getElementById("payment").value;
  const transaction=document.getElementById("paymentNumber").value;
  
  // Order object
  const order = {
    user: auth.currentUser.displayName,
    products: currentOrder.map(p=>{
      const qty = parseInt(document.querySelector(`.order-qty[data-id='${p.id}']`).value);
      return {name:p.name, price:p.price, quantity:qty};
    }),
    total: parseInt(document.getElementById("totalPrice").innerText),
    name,address,mobile,payment,transaction,
    timestamp: new Date()
  };

  // Save to Firebase Firestore
  db.collection("orders").add(order).then(()=>{
    alert("Order Placed Successfully!");
    cart = [];
    document.getElementById("cartCount").innerText=cart.length;
    closeModal();
    showHome();
  }).catch(err=>{
    alert("Error placing order: "+err.message);
  });
}

// Initialize product list
renderProducts();
</script>
</body>
</html>
